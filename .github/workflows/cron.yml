# This file was generated by ci/generate and should not be modified by hand
---
name: Scheduled rebuild
'on':
  workflow_dispatch:
  schedule:
  - cron: 7 2 * * *
env:
  DOCKER_HUB_USERNAME: shepmaster
  GH_CONTAINER_REGISTRY_USERNAME: shepmaster
  AWS_ACCESS_KEY_ID: AKIAWESVHZ3JQAY5NM5K
jobs:
  build_compiler_images:
    name: Release ${{ matrix.channel }} image
    runs-on: ubuntu-latest
    strategy:
      matrix:
        channel:
        - stable
        - beta
        - nightly
    env:
      GHCR_IMAGE_NAME: ghcr.io/integer32llc/rust-playground-ci-rust-${{ matrix.channel }}
      DOCKER_HUB_IMAGE_NAME: shepmaster/rust-${{ matrix.channel }}
    continue-on-error: true
    steps:
    - name: Checkout code
      uses: actions/checkout@v6
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3
    - name: Login to GitHub Container Registry
      uses: docker/login-action@v3
      with:
        registry: ghcr.io
        username: "${{ env.GH_CONTAINER_REGISTRY_USERNAME }}"
        password: "${{ secrets.GH_CONTAINER_REGISTRY_TOKEN }}"
    - name: Login to Docker Hub
      uses: docker/login-action@v3
      with:
        username: "${{ env.DOCKER_HUB_USERNAME }}"
        password: "${{ secrets.DOCKER_HUB_TOKEN }}"
    - name: Release ${{ matrix.channel }} image
      uses: "./.github/actions/build-and-push-image"
      with:
        channel: "${{ matrix.channel }}"
        tags: |-
          ${{ env.GHCR_IMAGE_NAME }}
          ${{ env.DOCKER_HUB_IMAGE_NAME }}
